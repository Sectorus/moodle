{"version":3,"sources":["../src/cm-selector.js"],"names":["define","$","Ajax","CourseResourceSelector","CmResourceSelector","lastUsedCourse","init","selector","initWithCourse","container","currentCourse","searchResultsContents","find","courseSearchField","cmSearchField","cs","onResourceSelected","e","resource","_iscourse","selectCourse","course","cms","_iscm","trigger","cm","on","reset","val","clear","hide","show","focus","text","fullname","initForCourse","id"],"mappings":"AAwBAA,OAAM,wBAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,mCAAxB,CAA6D,+BAA7D,CAAD,CAAgG,SAClGC,CADkG,CAElGC,CAFkG,CAGlGC,CAHkG,CAIlGC,CAJkG,CAKpG,CACE,GAAIC,CAAAA,CAAc,CAAG,IAArB,CAQA,QAASC,CAAAA,CAAT,CAAcC,CAAd,CAAwBC,CAAxB,CAAwC,CACpCA,CAAc,CAAGA,CAAc,EAAIH,CAAnC,CADoC,GAEhCI,CAAAA,CAAS,CAAGR,CAAC,CAACM,CAAD,CAFmB,CAGhCG,CAAa,CAAG,IAHgB,CAIhCC,CAAqB,CAAGF,CAAS,CAACG,IAAV,CAAe,yBAAf,CAJQ,CAKhCC,CAAiB,CAAGJ,CAAS,CAACG,IAAV,CAAe,qBAAf,CALY,CAMhCE,CAAa,CAAGL,CAAS,CAACG,IAAV,CAAe,iBAAf,CANgB,CAQhCG,CAAE,CAAG,GAAIZ,CAAAA,CAAJ,CAA2BQ,CAA3B,CAAkDE,CAAlD,CAR2B,CASpCE,CAAE,CAACC,kBAAH,CAAsB,SAASC,CAAT,CAAYC,CAAZ,CAAsB,CACxC,GAAI,CAACA,CAAQ,CAACC,SAAd,CAAyB,CACrB,MACH,CACDC,CAAY,CAACF,CAAQ,CAACG,MAAV,CACf,CALD,EAOA,GAAIC,CAAAA,CAAG,CAAG,GAAIlB,CAAAA,CAAJ,CAAuBO,CAAvB,CAA8CG,CAA9C,CAAV,CACAQ,CAAG,CAACN,kBAAJ,CAAuB,SAASC,CAAT,CAAYC,CAAZ,CAAsB,CACzC,GAAI,CAACA,CAAQ,CAACK,KAAd,CAAqB,CACjB,MACH,CACDd,CAAS,CAACe,OAAV,CAAkB,aAAlB,CAAiC,CAC7BC,EAAE,CAAEP,CAAQ,CAACO,EADgB,CAE7BJ,MAAM,CAAEX,CAFqB,CAAjC,CAIH,CARD,EAUAD,CAAS,CAACG,IAAV,CAAe,0BAAf,EAA2Cc,EAA3C,CAA8C,OAA9C,CAAuD,UAAW,CAC9DC,CAAK,EACR,CAFD,EAOA,QAASA,CAAAA,CAAT,EAAiB,CACbd,CAAiB,CAACe,GAAlB,CAAsB,EAAtB,EACAd,CAAa,CAACc,GAAd,CAAkB,EAAlB,EACAb,CAAE,CAACc,KAAH,GACApB,CAAS,CAACG,IAAV,CAAe,YAAf,EAA6BkB,IAA7B,GACArB,CAAS,CAACG,IAAV,CAAe,qCAAf,EAAsDmB,IAAtD,GACAtB,CAAS,CAACG,IAAV,CAAe,iCAAf,EAAkDkB,IAAlD,GACApB,CAAa,CAAG,IAAhB,CACAG,CAAiB,CAACmB,KAAlB,EACH,CAOD,QAASZ,CAAAA,CAAT,CAAsBC,CAAtB,CAA8B,CAC1BX,CAAa,CAAGW,CAAhB,CACAhB,CAAc,CAAGgB,CAAjB,CACAZ,CAAS,CAACG,IAAV,CAAe,sCAAf,EAAuDqB,IAAvD,CAA4DZ,CAAM,CAACa,QAAnE,EACAzB,CAAS,CAACG,IAAV,CAAe,iCAAf,EAAkDmB,IAAlD,GACAtB,CAAS,CAACG,IAAV,CAAe,qCAAf,EAAsDkB,IAAtD,GACArB,CAAS,CAACG,IAAV,CAAe,YAAf,EAA6BmB,IAA7B,GACAhB,CAAE,CAACc,KAAH,GAEAP,CAAG,CAACa,aAAJ,CAAkBd,CAAM,CAACe,EAAzB,EACAtB,CAAa,CAACc,GAAd,CAAkB,EAAlB,EACAd,CAAa,CAACkB,KAAd,EACH,CAED,GAAIxB,CAAJ,CAAoB,CAChBY,CAAY,CAACZ,CAAD,CACf,CAFD,IAEO,CACHmB,CAAK,EACR,CACJ,CAED,MAAO,CACHrB,IAAI,CAAEA,CADH,CAGV,CAxFK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course module selector.\n *\n * @package    block_xp\n * @copyright  2018 Frédéric Massart\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'block_xp/course-resource-selector', 'block_xp/cm-resource-selector'], function(\n    $,\n    Ajax,\n    CourseResourceSelector,\n    CmResourceSelector\n) {\n    var lastUsedCourse = null;\n\n    /**\n     * Initialise the module.\n     *\n     * @param {Jquery|String} selector The selector.\n     * @param {Object} [initWithCourse] The course to initialise with.\n     */\n    function init(selector, initWithCourse) {\n        initWithCourse = initWithCourse || lastUsedCourse;\n        var container = $(selector);\n        var currentCourse = null;\n        var searchResultsContents = container.find('.search-result-contents');\n        var courseSearchField = container.find('.search-term-course');\n        var cmSearchField = container.find('.search-term-cm');\n\n        var cs = new CourseResourceSelector(searchResultsContents, courseSearchField);\n        cs.onResourceSelected(function(e, resource) {\n            if (!resource._iscourse) {\n                return;\n            }\n            selectCourse(resource.course);\n        });\n\n        var cms = new CmResourceSelector(searchResultsContents, cmSearchField);\n        cms.onResourceSelected(function(e, resource) {\n            if (!resource._iscm) {\n                return;\n            }\n            container.trigger('cm-selected', {\n                cm: resource.cm,\n                course: currentCourse\n            });\n        });\n\n        container.find('.course-selection-change').on('click', function() {\n            reset();\n        });\n\n        /**\n         * Reset.\n         */\n        function reset() {\n            courseSearchField.val('');\n            cmSearchField.val('');\n            cs.clear();\n            container.find('.cm-search').hide();\n            container.find('.course-search .course-not-selected').show();\n            container.find('.course-search .course-selected').hide();\n            currentCourse = null;\n            courseSearchField.focus();\n        }\n\n        /**\n         * Select a course.\n         *\n         * @param {Object} course The course.\n         */\n        function selectCourse(course) {\n            currentCourse = course;\n            lastUsedCourse = course;\n            container.find('.course-search .course-selected span').text(course.fullname);\n            container.find('.course-search .course-selected').show();\n            container.find('.course-search .course-not-selected').hide();\n            container.find('.cm-search').show();\n            cs.clear();\n\n            cms.initForCourse(course.id);\n            cmSearchField.val('');\n            cmSearchField.focus();\n        }\n\n        if (initWithCourse) {\n            selectCourse(initWithCourse);\n        } else {\n            reset();\n        }\n    }\n\n    return {\n        init: init\n    };\n});\n"],"file":"cm-selector.min.js"}